# 学工智能体系统 - 后端

## 项目简介

学工智能体系统是一个基于 Spring Boot 的智能学工管理平台，提供智能咨询、请假管理、奖助申请等功能。系统采用前后端分离架构，后端提供 RESTful API 服务。

## 功能需求

### 3.1 智能咨询助手

#### 3.1.1 高频问题解答

覆盖奖助勤贷、宿舍管理、违纪申诉、心理健康、就业指导等场景，提供精准答案及流程指引。

#### 3.1.2 多模态交互

支持文字、语音、图片交互（如上传申请材料咨询合规性）。

#### 3.1.3 人工转接

自动识别复杂问题（如特殊情况申诉），或用户主动申请人工，同步咨询上下文至辅导员/学工处人员。

### 3.2 流程代办服务

#### 3.2.1 请假/销假办理

支持事假/病假/公假在线申请、请假条生成，审批进度实时推送，销假自动关联请假记录。

#### 3.2.2 奖助申请办理

奖学金、助学金、困难补助在线提交，材料预审（自动校验完整性），结果通知多渠道推送。

> **注意**：3.1.1 高频问题解答和 3.1.2 多模态交互需要引入 Agent 实现，其他功能正常实现。

## 技术架构

### 一、技术选型概述

本系统采用前后端分离架构，后端基于 Spring Boot 构建 RESTful API，前端使用 Vue3 框架结合 Ant Design Vue 组件库实现响应式界面。系统遵循微服务设计理念，采用容器化部署方案，整体架构具备高可用性、高可扩展性和良好的用户体验。

### 二、后端技术架构

#### 1. 核心框架

- **Spring Boot 3.2.8**：作为基础框架，提供快速启动和自动配置
- **Spring MVC**：处理 HTTP 请求，实现 RESTful API
- **Spring Security + JWT**：实现认证授权机制，支持 RBAC 权限模型
- **Spring Data JPA + QueryDSL**：数据持久层，支持复杂动态查询
- **Spring Cache**：提供统一的缓存抽象层
- **Spring Boot Actuator**：系统监控和健康检查

#### 2. 数据库设计

**主数据库：MySQL 8.4**

- 支持事务和高并发读写
- 使用 InnoDB 存储引擎，支持行级锁
- 主从复制架构，读写分离
- 配置连接池：HikariCP，最大连接数 50，最小空闲连接数 10

**缓存数据库：Redis 7.x**

- 哨兵模式部署，保证高可用
- 缓存策略：热点数据缓存，默认过期时间 30 分钟
- 使用 Redisson 实现分布式锁

**分库分表**

- 对于大数据量表，采用 ShardingSphere 进行水平分表

#### 3. 性能与优化

**服务器配置**

- 应用服务器：8 核 16GB
- 数据库服务器：8 核 16GB，SSD 存储
- 单节点支撑并发：3000 TPS，响应时间 < 100ms

**缓存策略**

- 一级缓存：本地 Caffeine 缓存，过期时间 5 分钟
- 二级缓存：Redis 分布式缓存，过期时间 30 分钟

**数据库优化**

- 关键查询字段建立索引，联合索引遵循最左前缀原则
- 大表分页使用基于游标的分页方式
- 慢查询日志监控，定期优化 SQL

### 三、前端技术架构

#### 1. 核心框架

- **Vue 3**：采用组合式 API，提升代码可维护性
- **TypeScript 5.x**：强类型支持，减少运行时错误
- **Vite 5.x**：构建工具，支持模块热替换
- **Ant Design Vue 4.x**：UI 组件库，主题可定制
- **Pinia 2.x**：状态管理，替代 Vuex
- **Vue Router 4.x**：路由管理，支持路由守卫

#### 2. 工程化配置

**代码规范**

- ESLint + Prettier + Stylelint
- Git Commit Message Convention

**构建优化**

- 分包策略：vendor、ant-design-vue 单独打包
- Tree Shaking：移除未使用代码
- 图片压缩：转 Base64 或使用 WebP 格式
- CDN 加速：第三方依赖使用 CDN 引入

#### 3. 性能优化

**首屏加载优化**

- 路由懒加载
- 组件异步加载
- 骨架屏技术

**资源优化**

- 图片懒加载（Intersection Observer API）
- 字体图标替代图片图标
- Gzip 压缩，Brotli 高级压缩

**缓存策略**

- Service Worker 实现 PWA
- 浏览器本地缓存 API 响应

### 四、部署架构

#### 1. 部署环境要求

- **操作系统**：CentOS 7.9+ / Ubuntu 20.04 LTS
- **Java 环境**：JDK 17+
- **Web 服务器**：Nginx 1.20+
- **数据库**：MySQL 8.4，Redis 7.x
- **消息队列**：RabbitMQ 3.12+
- **系统用户**：创建专用应用用户（如：appuser）

### 五、开发规范

#### 1. 后端规范

- **代码结构**：遵循 DDD 领域驱动设计
- **API 设计**：遵循 RESTful 规范，版本控制（/api/v1/）
- **异常处理**：统一异常处理器，全局错误码定义
- **参数校验**：使用 Validation API，自定义校验器
- **日志规范**：使用 SLF4J + Logback，分级记录

#### 2. 前端规范

- **目录结构**：按功能模块划分
- **组件规范**：单一职责，可复用
- **状态管理**：Pinia 集中管理全局状态
- **API 封装**：统一请求拦截和响应处理

#### 3. 数据库规范

- **命名规范**：表名小写+下划线，字段名明确
- **索引规范**：联合索引不超过 5 个字段
- **SQL 规范**：避免 SELECT \*，使用 JOIN 替代子查询

#### 4. 接口文档

- **Swagger/OpenAPI 3.0**：自动生成接口文档
- **接口版本**：兼容性保证，至少保留 3 个历史版本
- **接口 Mock**：前后端并行开发支持

### 六、AI 服务集成（千问推理大模型）

为提升系统智能决策与自然语言处理能力，本架构通过集成千问推理大模型的平台 API，快速引入智能问答、文本生成、逻辑推理等 AI 能力，无需自主维护模型基础设施。

#### 集成方式与架构

- **调用模式**：采用 HTTPS 调用大模型平台提供的公开 API 接口
- **客户端**：在 Spring Boot 后端服务中，使用 RestTemplate 或 WebClient 封装专用 HTTP 客户端，用于发起模型请求与处理响应
- **服务化封装**：将大模型 API 的调用封装为内部独立的服务或组件，向上层业务提供简洁、统一的编程接口

#### 性能与稳定性保障

- **连接池管理**：配置专用 HTTP 连接池，优化与平台 API 服务器的连接复用，减少握手开销
- **超时与重试**：设置合理的连接、读取超时时间，并针对可重试的错误（如网络抖动、API 限流）实现带有退避策略的自动重试机制
- **结果缓存**：对频繁且结果确定的推理请求（如通用问题解答），其响应结果在 Redis 中进行缓存，有效降低调用成本与延迟
- **异步与队列**：对于耗时较长的推理任务，采用异步调用或通过 RabbitMQ 消息队列进行任务下发与结果回调，避免阻塞主业务流程

#### 安全、成本与治理

- **请求审计与限流**：记录所有对外 API 调用的日志，用于成本分析和审计。在网关与业务层实现双重限流，严格控制调用频率以管理成本
- **数据安全**：在调用前对用户输入进行必要的脱敏处理。确保与大模型平台之间的通信启用 TLS 加密
- **密钥管理**：API Key 等认证凭据统一存储于配置中心（如 Nacos），并通过环境变量注入，严禁硬编码在代码中
- **熔断降级**：当平台 API 服务不稳定或响应过慢时，通过熔断器（如 Resilience4j）快速失败，并可降级到基于规则的本地回复或友好提示，保障核心业务可用性

#### 典型应用场景

- 智能客服自动问答
- 用户生成内容的合规性与质量辅助审核
- 从非结构化文本中提取关键信息并结构化
- 辅助生成报告摘要、内容推荐理由等文本

## 快速开始

### 环境要求

- JDK 17+
- Maven 3.6+
- MySQL 8.4+
- Redis 7.x+
- RabbitMQ 3.12+

### 配置说明

1. 修改 `src/main/resources/application.properties` 中的数据库连接配置
2. 配置 Redis 连接信息
3. 配置 RabbitMQ 连接信息
4. 配置千问大模型 API Key（通过环境变量 `QIANWEN_API_KEY` 注入）
5. 配置 JWT 密钥（通过环境变量 `JWT_SECRET` 注入）

### 运行项目

```bash
# 编译项目
mvn clean compile

# 运行项目
mvn spring-boot:run

# 或打包后运行
mvn clean package
java -jar target/learn-work-agent-end-0.0.1-SNAPSHOT.jar
```

### 访问接口文档

启动项目后，访问 Swagger UI：

```
http://localhost:8080/swagger-ui.html
```

## 项目结构

```
learn-work-agent-end/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/example/learnworkagent/
│   │   │       ├── common/          # 公共模块
│   │   │       ├── domain/          # 领域模块（DDD）
│   │   │       ├── infrastructure/   # 基础设施层
│   │   │       ├── interfaces/     # 接口层（Controller）
│   │   │       └── LearnWorkAgentApplication.java
│   │   └── resources/
│   │       ├── application.properties
│   │       └── redisson-config.yaml
│   └── test/                        # 测试代码
└── pom.xml
```

## 许可证

本项目为毕业设计项目，仅供学习使用。
